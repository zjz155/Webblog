{% load static %}
<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8" />
        <title id="title"></title>
        <link rel="stylesheet" href="/static/css/style.css" />
        <link rel="stylesheet" href="/static/plugins/editor.md/css/editormd.preview.css" />
{#        <link rel="shortcut icon" href="https://pandao.github.io/editor.md/favicon.ico" type="image/x-icon" />#}
        <link rel="stylesheet" href="/static/plugins/bootstrap-4.1.3-dist/css/bootstrap.min.css">
        <link href="/static/css/sticky-footer-navbar.css" rel="stylesheet">

        <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
        <script src="/static/js/jquery-3.4.1.min.js"></script>

        <!-- popper.min.js 用于弹窗、提示、下拉菜单 -->
        <script src="/static/js/popper.min.js"></script>

        <!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
        <script src="/static/plugins/bootstrap-4.1.3-dist/js/bootstrap.min.js"></script>
        <style>
            .editormd-html-preview {
                width: 90%;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>

        <div id="layout">
            <header>
              <!-- Fixed navbar -->
              <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <a class="navbar-brand" href="#">个人博客客</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                  <ul class="navbar-nav mr-auto">
                    <li class="nav-item ">
                      <a class="nav-link" href="/index/html/">首页 <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link disabled" href="#">个人中心</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link disabled" href="#">项目介绍</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/compile_blog/" target="_blank">Markdown编辑器</a>
                    </li>
                  </ul>
                  <div class="form-inline mt-2 mt-md-0">

                      <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
                      <button class="btn btn-outline-success my-2 my-sm-0" id="login">登录</button>&nbsp;&nbsp;
                      <button class="btn btn-outline-success my-2 my-sm-0" id="register">注册</button>
                  </div>
                </div>
              </nav>
            </header>
            <br/>
            <br/>



            <div id="test-editormd-view">
               <textarea style="display:none;" name="test-editormd-markdown-doc"> {{ markdown }}</textarea>
            </div>
            <div id="test-editormd-view2">
                <textarea id="append-test" style="display:none;">


{####科学公式 TeX(KaTeX)#}
{##}
{#$$E=mc^2$$#}
{##}
{#行内的公式$$E=mc^2$$行内的公式，行内的$$E=mc^2$$公式。#}
{##}
{#$$\(\sqrt{3x-1}+(1+x)^2\)$$#}
{##}
{#$$\sin(\alpha)^{\theta}=\sum_{i=0}^{n}(x^i + \cos(f))$$#}
{##}
{#$$X^2 > Y$$#}
{##}

                </textarea>
            </div>
        </div>
        <!-- <script src="js/zepto.min.js"></script>
		<script>
			var jQuery = Zepto;  // 为了避免修改flowChart.js和sequence-diagram.js的源码，所以使用Zepto.js时想支持flowChart/sequenceDiagram就得加上这一句
		</script> -->
        <script src="/static/js/jquery.min.js"></script>

        <script src="/static/plugins/editor.md/lib/marked.min.js"></script>
        <script src="/static/plugins/editor.md/lib/prettify.min.js"></script>

        <script src="/static/plugins/editor.md/lib/raphael.min.js"></script>
        <script src="/static/plugins/editor.md/lib/underscore.min.js"></script>
        <script src="/static/plugins/editor.md/lib/sequence-diagram.min.js"></script>
        <script src="/static/plugins/editor.md/lib/flowchart.min.js"></script>
        <script src="/static/plugins/editor.md/lib/jquery.flowchart.min.js"></script>

        <script src="/static/plugins/editor.md/editormd.js"></script>
        <script type="text/javascript">
            $(function() {
                $.ajax({
                     url: "/is_login/",
                     type: "post",
                     dataType: "json",
                     headers:{
                         "Authorization": "Bearer" + " " +  window.localStorage.getItem("token")
                     },

                     success: function (data, status) {
                         if (data.success) {
                             $("#login").html("退出");
                             $("#register").html(data.username)
                         }
                     },
                     error: function (XHR, textStatus, errorThrown) {
                         alert("响应状态=" + textStatus );
                     },

                 });

                 $("#login").click(function(){
                     if ($("#login").html() ==="退出"){
                        window.localStorage.clear();
                        $("#login").html("登录");
                         $("#register").html("注册");
                     }
                     else
                         $(window).attr("location", "/login/")

                 });

                $("#register").click(function(){
                     if ($("#register").html() ==="注册"){
                          $(location).attr("href", "/register/")

                     }

                });

                var testEditormdView, testEditormdView2;

                $.get("/{{ username }}/article/details/{{ article_id }}/data/", function(markdown) {
                    console.log(markdown);
                    headline = markdown["headline"];
				    testEditormdView = editormd.markdownToHTML("test-editormd-view", {
                        markdown        : "## " + markdown["headline"] + "\r\n" + markdown["content"],//+ "\r\n" + $("#append-test").text(),
                        //htmlDecode      : true,       // 开启 HTML 标签解析，为了安全性，默认不开启
                        htmlDecode      : "style,script,iframe",  // you can filter tags decode
                        //toc             : false,
                        tocm            : true,    // Using [TOCM]
                        //tocContainer    : "#custom-toc-container", // 自定义 ToC 容器层
                        //gfm             : false,
                        //tocDropdown     : true,
                        // markdownSourceCode : true, // 是否保留 Markdown 源码，即是否删除保存源码的 Textarea 标签
                        emoji           : true,
                        taskList        : true,
                        tex             : true,  // 默认不解析
                        flowChart       : true,  // 默认不解析
                        sequenceDiagram : true,  // 默认不解析
                    });

				    $("#title").html(headline)

                    //console.log("返回一个 jQuery 实例 =>", testEditormdView);

                    // 获取Markdown源码
                    //console.log(testEditormdView.getMarkdown());

                    //alert(testEditormdView.getMarkdown());
                });

                testEditormdView2 = editormd.markdownToHTML("test-editormd-view2", {
                    htmlDecode      : "style,script,iframe",  // you can filter tags decode
                    emoji           : true,
                    taskList        : true,
                    tex             : true,  // 默认不解析
                    flowChart       : true,  // 默认不解析
                    sequenceDiagram : true,  // 默认不解析
                });
            });
        </script>
    </body>